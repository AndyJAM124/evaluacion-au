<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulaci√≥n de Andamiaje v7.0 (Dise√±o Horizontal)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            line-height: 1.6;
            background-color: #f4f7f6;
            color: #333;
            /* Se quita el max-width de 600px de aqu√≠ */
        }

        /* --- NUEVO: Contenedor Principal --- */
        #page-container {
            max-width: 1100px; /* M√°s ancho para el modo horizontal */
            margin: 20px auto;
            padding: 0 20px;
        }

        /* --- Selector de Modo (Ahora dentro del contenedor) --- */
        #mode-selector {
            text-align: center;
            margin-bottom: 20px;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .mode-btn {
            background-color: #6c757d;
            padding: 10px 15px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            margin: 0 5px;
        }
        .mode-btn:hover { background-color: #5a6268; }
        .mode-btn.active { background-color: #007bff; }
        .mode-btn.active:hover { background-color: #0056b3; }

        /* --- NUEVO: Layout de 2 Paneles --- */
        #main-layout {
            display: flex;
            flex-direction: row;
            gap: 20px;
            align-items: flex-start; /* Alinea los paneles arriba */
        }
        
        /* --- Panel Izquierdo (Problema) --- */
        #panel-left {
            flex: 2; /* Ocupa 2/3 del espacio */
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        /* --- Panel Derecho (Controles) --- */
        #panel-right {
            flex: 1; /* Ocupa 1/3 del espacio */
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #ddd;
            /* Se mantiene pegado arriba mientras se scrollea (opcional) */
            position: sticky; 
            top: 20px;
        }
        .control-section {
            margin-bottom: 25px;
        }
        .control-section:last-child {
            margin-bottom: 0;
        }
        
        /* --- Estilos de Gr√°fico Waffle --- */
        #waffle-container {
            display: grid;
            gap: 4px;
            width: 90%; /* M√°s grande dentro de su panel */
            max-width: 400px; 
            margin: 20px auto;
            border: 2px solid #333;
            border-radius: 5px;
            padding: 10px;
            background-color: #f9f9f9;
        }
        .waffle-square {
            width: 100%;
            padding-bottom: 100%; 
            position: relative;
            border: 1px solid #999;
            box-sizing: border-box;
        }
        .waffle-filled { background-color: #007bff; }
        .waffle-empty { background-color: #e0e0e0; }
        .waffle-clickable { cursor: pointer; }
        .waffle-clickable:hover { background-color: #cce5ff; }

        /* --- Estilos de Input de Fracci√≥n --- */
        .fraccion-input-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
        }
        .fraccion-input-container input[type="number"] {
            width: 70px;
            padding: 10px;
            font-size: 1.5em;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 5px;
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .fraccion-input-container input[type="number"]::-webkit-outer-spin-button,
        .fraccion-input-container input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .fraccion-barra { font-size: 2.5em; font-weight: bold; margin: 0 15px; color: #555; }

        #modo-escritura { display: none; }
        #modo-dibujo { display: none; }
        #text-prompt { font-size: 1.8em; font-weight: bold; color: #0056b3; text-align: center; margin: 10px 0; }
        #main-instruction { font-size: 1.1em; font-weight: bold; text-align: center; display: block; margin-bottom: 10px; }
        
        /* --- Estilos de Pistas y Botones (Ahora en Panel Derecho) --- */
        .pista { background-color: #FFF2CC; padding: 12px; margin-top: 15px; border-radius: 5px; border-left: 5px solid #ffc107; display: none; }
        .modelo { background-color: #F8CBAD; padding: 12px; margin-top: 15px; border-radius: 5px; border-left: 5px solid #dc3545; display: none; }
        
        button {
            display: inline-block;
            background-color: #007bff;
            color: #fff;
            padding: 12px 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.2s;
            /* NUEVO: Botones ocupan todo el ancho del panel */
            width: 100%;
            box-sizing: border-box; /* Para que el padding no rompa el 100% */
        }
        button:hover { background-color: #0056b3; }
        #btn-pista { background-color: #ffc107; color: #333; }
        #btn-pista:hover { background-color: #e0a800; }
        #btn-modelo { background-color: #dc3545; }
        #btn-modelo:hover { background-color: #c82333; }
        #btn-reiniciar { background-color: #6c757d; }
        #btn-reiniciar:hover { background-color: #5a6268; }

        /* --- Estilos de Diagn√≥stico (Panel Derecho) --- */
        #diagnostico { margin-top: 20px; padding: 15px; font-weight: bold; font-size: 1.1em; text-align: center; border-radius: 5px; display: none; line-height: 1.5; }
        .diag-success { background-color: #E2F0D9; color: #28a745; border: 1px solid #28a745; }
        .diag-warning { background-color: #FFF2CC; color: #ffc107; border: 1px solid #ffc107; }
        .diag-danger  { background-color: #F8CBAD; color: #dc3545; border: 1px solid #dc3545; }
        .diag-incorrect { background-color: #F8D7DA; color: #721c24; border: 1px solid #721c24; }
        .next-step { width: 100%; margin-top: 15px; display: none; box-sizing: border-box; }
        #btn-fase-siguiente { background-color: #28a745; }
        #btn-fase-siguiente:hover { background-color: #218838; }
        #btn-fase-3 { background-color: #ffc107; color: #333; }
        #btn-fase-3:hover { background-color: #e0a800; }
        #btn-fase-2 { background-color: #dc3545; }
        #btn-fase-2:hover { background-color: #c82333; }
    </style>
</head>
<body>
    
    <div id="page-container">

        <div id="mode-selector">
            <button class="mode-btn" id="btn-mode-write" onclick="setMode('write')">Practicar: Escribir Fracci√≥n</button>
            <button class="mode-btn" id="btn-mode-draw" onclick="setMode('draw')">Practicar: Dibujar Fracci√≥n</button>
        </div>

        <div id="main-layout">
            
            <div id="panel-left">
                <h2>Fase 5: Evaluaci√≥n de Autonom√≠a</h2>
                <label id="main-instruction"></label>
                
                <div id="waffle-container"></div>
                
                <div id="modo-escritura">
                    <div class="fraccion-input-container">
                        <input type="number" id="numerador" aria-label="Numerador" min="0">
                        <span class="fraccion-barra">/</span>
                        <input type="number" id="denominador" aria-label="Denominador" min="1">
                    </div>
                </div>
                <div id="modo-dibujo">
                    <div id="text-prompt"></div>
                </div>
            </div>

            <div id="panel-right">
                
                <div class="control-section">
                    <p>¬øNecesitas ayuda? (Intenta resolverlo sin ayuda primero)</p>
                    <button id="btn-pista" onclick="mostrarPista()">Pedir Pista (Nivel 2)</button>
                    <button id="btn-modelo" onclick="mostrarModelo()">Pedir Modelo (Nivel 3)</button>
                    <div id="pista-nivel2" class="pista">
                        <span id="pista-escritura">Recuerda: El n√∫mero de abajo (Denominador) es TODAS las partes. El n√∫mero de arriba (Numerador) es solo las partes coloreadas.</span>
                        <span id="pista-dibujo">Recuerda: El n√∫mero de abajo (Denominador) te dice en cu√°ntas partes dividirlo. El n√∫mero de arriba (Numerador) te dice cu√°ntas debes colorear.</span>
                    </div>
                    <div id="pista-nivel3" class="modelo">
                        <span id="modelo-escritura">Modelo: Mira este ejemplo: <strong>[ ‚ñ® ‚ñ¢ ‚ñ¢ ‚ñ¢ ]</strong> (1/4). Tiene 4 partes totales y 1 coloreada.</span>
                        <span id="modelo-dibujo">Modelo: Mira c√≥mo se dibuja 1/4: Coloreas 1 cuadro de un total de 4.</span>
                    </div>
                </div>
                
                <div class="control-section">
                    <hr>
                    <button onclick="evaluar()">Revisar mi Respuesta</button>
                    <button id="btn-reiniciar" onclick="reiniciarSimulacion()">Reiniciar (Nuevo Problema)</button>
                </div>
                
                <div class="control-section">
                    <div id="diagnostico"></div>
                    <div id="botones-bucle">
                        <button id="btn-fase-siguiente" class="next-step" onclick="accionBucle('siguiente')">‚úÖ ¬°Felicidades! Ir al Siguiente Tema</button>
                        <button id="btn-fase-3" class="next-step" onclick="accionBucle('fase3')">üîÑ Volver a Fase 3: Pr√°ctica Aut√≥noma (Reforzar)</button>
                        <button id="btn-fase-2" class="next-step" onclick="accionBucle('fase2')">üîÑ Volver a Fase 2: Pr√°ctica Guiada (Re-ense√±ar)</button>
                    </div>
                </div>

            </div>
        </div>
    </div> <script>
        // --- TODO EL JAVASCRIPT SIGUE SIENDO EXACTAMENTE EL MISMO ---
        // (No es necesario repetirlo, solo copia y pega el script
        // de la Versi√≥n 6.0 aqu√≠)
        
        const fractionPool = [
            { num: 1, den: 4 }, { num: 3, den: 4 }, { num: 1, den: 6 }, { num: 5, den: 6 },
            { num: 3, den: 8 }, { num: 5, den: 8 }, { num: 7, den: 8 }, { num: 2, den: 9 },
            { num: 4, den: 9 }, { num: 7, den: 9 }, { num: 1, den: 10 }, { num: 3, den: 10 },
            { num: 7, den: 10 }, { num: 9, den: 10 }, { num: 1, den: 12 }, { num: 5, den: 12 },
            { num: 7, den: 12 }, { num: 11, den: 12 }, { num: 4, den: 15 }, { num: 8, den: 15 },
            { num: 5, den: 16 }, { num: 9, den: 16 }
        ];

        let currentFraction = {};
        let currentMode = 'write';
        let nivelDeAyudaUsado = 1;
        let clickedSquares = new Set();

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btn-mode-write').classList.toggle('active', mode === 'write');
            document.getElementById('btn-mode-draw').classList.toggle('active', mode === 'draw');
            generarNuevoProblema();
        }

        function getGridDimensions(denominator) {
            switch (denominator) {
                case 4: return { rows: 2, cols: 2 };
                case 6: return { rows: 2, cols: 3 };
                case 8: return { rows: 2, cols: 4 };
                case 9: return { rows: 3, cols: 3 };
                case 10: return { rows: 2, cols: 5 };
                case 12: return { rows: 3, cols: 4 };
                case 15: return { rows: 3, cols: 5 };
                case 16: return { rows: 4, cols: 4 };
                default: return { rows: 1, cols: denominator };
            }
        }

        function generarNuevoProblema() {
            const randomIndex = Math.floor(Math.random() * fractionPool.length);
            currentFraction = fractionPool[randomIndex];
            actualizarVisuales();
        }

        function actualizarVisuales() {
            const { num, den } = currentFraction;
            const container = document.getElementById('waffle-container');
            const { rows, cols } = getGridDimensions(den);

            container.innerHTML = '';
            container.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            
            document.getElementById('modo-escritura').style.display = (currentMode === 'write') ? 'block' : 'none';
            document.getElementById('modo-dibujo').style.display = (currentMode === 'draw') ? 'block' : 'none';
            
            document.getElementById('pista-escritura').style.display = (currentMode === 'write') ? 'block' : 'none';
            document.getElementById('pista-dibujo').style.display = (currentMode === 'draw') ? 'block' : 'none';
            document.getElementById('modelo-escritura').style.display = (currentMode === 'write') ? 'block' : 'none';
            document.getElementById('modelo-dibujo').style.display = (currentMode === 'draw') ? 'block' : 'none';
            
            clickedSquares.clear();
            ocultarResultados();
            document.getElementById('numerador').value = "";
            document.getElementById('denominador').value = "";
            nivelDeAyudaUsado = 1;

            for (let i = 0; i < den; i++) {
                const square = document.createElement('div');
                square.dataset.index = i;

                if (currentMode === 'write') {
                    document.getElementById('main-instruction').innerText = "Escribe la fracci√≥n que representa este dibujo:";
                    square.classList.add('waffle-square');
                    square.classList.add( (i < num) ? 'waffle-filled' : 'waffle-empty' );
                } else {
                    document.getElementById('main-instruction').innerText = "Haz clic en los cuadros para dibujar la fracci√≥n:";
                    document.getElementById('text-prompt').innerText = `${num} / ${den}`;
                    square.classList.add('waffle-square', 'waffle-empty', 'waffle-clickable');
                    square.addEventListener('click', toggleSquare);
                }
                container.appendChild(square);
            }
        }

        function toggleSquare(event) {
            const square = event.target;
            const index = parseInt(square.dataset.index);

            if (clickedSquares.has(index)) {
                clickedSquares.delete(index);
                square.classList.remove('waffle-filled');
                square.classList.add('waffle-empty');
            } else {
                clickedSquares.add(index);
                square.classList.add('waffle-filled');
                square.classList.remove('waffle-empty');
            }
        }

        function mostrarPista() {
            document.getElementById('pista-nivel2').style.display = 'block';
            if (nivelDeAyudaUsado < 2) { nivelDeAyudaUsado = 2; }
        }
        function mostrarModelo() {
            document.getElementById('pista-nivel3').style.display = 'block';
            nivelDeAyudaUsado = 3;
        }
        function ocultarResultados() {
            document.getElementById('diagnostico').style.display = 'none';
            document.getElementById('btn-fase-siguiente').style.display = 'none';
            document.getElementById('btn-fase-3').style.display = 'none';
            document.getElementById('btn-fase-2').style.display = 'none';
        }

        function evaluar() {
            ocultarResultados();
            
            let esCorrecto = false;
            let respuestaMostrada = "";
            const { num, den } = currentFraction;

            if (currentMode === 'write') {
                let numInput = document.getElementById('numerador').value;
                let denInput = document.getElementById('denominador').value;
                esCorrecto = (numInput === String(num) && denInput === String(den));
                respuestaMostrada = `${numInput || '?'}/${denInput || '?'}`;
            } else {
                esCorrecto = (clickedSquares.size === num);
                respuestaMostrada = `${clickedSquares.size}/${den}`;
            }

            let diagnosticoElement = document.getElementById('diagnostico');
            diagnosticoElement.style.display = 'block';

            if (esCorrecto) {
                switch (nivelDeAyudaUsado) {
                    case 1:
                        diagnosticoElement.innerHTML = "¬°EXCELENTE! ¬°Felicidades!<br>Resuelto en Nivel 1 (Autonom√≠a Total).<br><b>DIAGN√ìSTICO: ZDP Superada. ¬°RETIRAR ANDAMIO!</b>";
                        diagnosticoElement.className = "diag-success";
                        document.getElementById('btn-fase-siguiente').style.display = 'block';
                        break;
                    case 2:
                        diagnosticoElement.innerHTML = "¬°Resuelto con Nivel 2 (Pista)!<br>DIAGN√ìSTICO: En la ZDP. MANTENER ANDAMIO LIGERO.";
                        diagnosticoElement.className = "diag-warning";
                        document.getElementById('btn-fase-3').style.display = 'block';
                        break;
                    case 3:
                        diagnosticoElement.innerHTML = "¬°Resuelto con Nivel 3 (Modelo)!<br>DIAGN√ìSTICO: Fuera de la ZDP. MANTENER ANDAMIO FUERTE.";
                        diagnosticoElement.className = "diag-danger";
                        document.getElementById('btn-fase-2').style.display = 'block';
                        break;
                }
            } else {
                diagnosticoElement.innerHTML = `Respuesta incorrecta (${respuestaMostrada}). Intenta de nuevo. Pide ayuda si la necesitas.`;
                diagnosticoElement.className = "diag-incorrect";
            }
        }

        function accionBucle(destino) {
            if (destino === 'siguiente') {
                alert("¬°Felicidades! Pasando al siguiente tema: Fracciones Equivalentes.");
            } else if (destino === 'fase3') {
                alert("Acci√≥n: Regresando al estudiante a la Fase 3 (Pr√°ctica Aut√≥noma) con m√°s ejercicios.");
            } else if (destino === 'fase2') {
                alert("Acci√≥n: Regresando al estudiante a la Fase 2 (Pr√°ctica Guiada) con el docente.");
            }
            reiniciarSimulacion();
        }

        function reiniciarSimulacion() {
            generarNuevoProblema();
        }

        window.onload = () => {
            setMode('write'); // Inicia en modo 'write' por defecto
        };
    </script>

</body>
</html>